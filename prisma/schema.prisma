generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String     @id @default(uuid())
  name            String
  email           String     @unique
  phoneNumber     String
  personalNumber  String     @unique
  address         String
  pinNumber       String?
  role            Role       @default(USER)
  userStatus      UserStatus @default(PENDING)
  profileImageUrl String?
  lastLogin       DateTime?
  notes           String?
  jobContract     String?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  companies Company[]
}

enum Role {
  USER
  ADMIN
  SUPERADMIN
}

enum UserStatus {
  PENDING
  ACTIVE
  INACTIVE
  SUSPENDED
  DELETED
}

model Company {
  id              String        @id @default(cuid())
  adminId         String
  user            User          @relation(fields: [adminId], references: [id])
  name            String
  email           String
  organizationNo  String        @unique
  loginCode       String
  contractDetails String?
  price           Float
  paymentStatus   PaymentStatus @default(PENDING)
  paymentInfo     String?
  invoices        Invoice[]
  employees       Employee[]
  schedules       Schedule[]
  salarySlips     SalarySlip[]

  timeLogs  TimeLog[]
  dailyTips DailyTip[]

  costTypes CostType[]
  costs     Cost[]

  sales            Sale[]
  messages         Message[]
  employeeMessages EmployeeMessage[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum PaymentStatus {
  PAID
  PENDING
  OVERDUE
}

model Invoice {
  id        String        @id @default(cuid())
  companyId String
  company   Company       @relation(fields: [companyId], references: [id])
  amount    Float
  month     Int
  year      Int
  pdfUrl    String?
  status    PaymentStatus @default(PENDING)
  createdAt DateTime      @default(now())
}

model Employee {
  id        String  @id @default(cuid())
  companyId String
  company   Company @relation(fields: [companyId], references: [id])
  name      String

  address    String?
  postalCode String?
  city       String?
  country    String?

  employmentType        EmploymentType?
  employementPercentage Float?
  workplace             String?
  jobTitle              String?
  workingStatus         WorkingStatus?

  tax            Float?
  paymentMethod  PaymentMethod?
  bankName       String?
  clearingNumber String?
  accountNumber  String?

  insurance        Boolean @default(true)
  insuranceCompany String?
  financialSupport Boolean @default(false)
  companyCar       Boolean @default(false)
  mealAllowance    Boolean @default(false)
  unionFees        Boolean @default(false)
  netDeduction     Boolean @default(false)
  jobStartDate DateTime?
  jobEndDate   DateTime?


  email            String?
  phone            String?
  personalNumber   String?
  pinCode          String
  contractType     ContractType
  hourlyRate       Float?
  monthlySalary    Float?
  schedules        Schedule[]
  timeLogs         TimeLog[]
  salarySlips      SalarySlip[]
  messages         Message[]
  employeeMessages EmployeeMessage[]
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
}

enum WorkingStatus {
  ACTIVE
  TERMINATED
  LEAVE
  PENDING
  OTHER
}

enum PaymentMethod {
  BANKTRANSFER
  PAYROLLFILE
  MANUAL
  OTHER
}

enum EmploymentType {
  PERMANENT
  INTERN
  TEMPORARY
  PROVISIONARY
  OTHER
}

enum ContractType {
  HOURLY
  MONTHLY
}

model Schedule {
  id         String   @id @default(cuid())
  companyId  String
  company    Company  @relation(fields: [companyId], references: [id])
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id])
  date       DateTime
  startTime  DateTime
  endTime    DateTime
  isAccepted Boolean  @default(false)
  createdAt  DateTime @default(now())

  @@index([companyId, employeeId])
  @@index([startTime, endTime])
}

model TimeLog {
  id String @id @default(cuid())

  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id])

  companyId String
  company   Company @relation(fields: [companyId], references: [id])

  logDate      DateTime
  loginTime    DateTime?
  logoutTime   DateTime?
  totalMinutes Int?

  isScheduled Boolean   @default(false)
  activatedAt DateTime?

  createdAt DateTime @default(now())

  @@index([companyId, logDate])
}

model SalarySlip {
  id         String       @id @default(cuid())
  employeeId String
  employee   Employee     @relation(fields: [employeeId], references: [id])
  companyId  String
  company    Company      @relation(fields: [companyId], references: [id])
  month      Int
  year       Int
  totalHours Float
  totalPay   Float
  pdfUrl     String?
  status     SalaryStatus @default(PENDING)
  createdAt  DateTime     @default(now())
  totalTips  Float?       @default(0)
}

enum SalaryStatus {
  PENDING
  PAID
  REJECTED
}

model DailyTip {
  id        String  @id @default(cuid())
  companyId String
  company   Company @relation(fields: [companyId], references: [id])

  date   DateTime
  amount Float

  createdAt DateTime @default(now())

  @@unique([companyId, date])
}

model CostType {
  id        String   @id @default(cuid())
  companyId String
  company   Company  @relation(fields: [companyId], references: [id])
  name      String
  createdAt DateTime @default(now())
  costs     Cost[]

  @@unique([companyId, name])
}

model Cost {
  id         String   @id @default(cuid())
  companyId  String
  company    Company  @relation(fields: [companyId], references: [id])
  costTypeId String
  costType   CostType @relation(fields: [costTypeId], references: [id])
  date       DateTime
  amount     Float
  createdAt  DateTime @default(now())

  @@index([companyId, date])
}

model Sale {
  id        String  @id @default(cuid())
  companyId String
  company   Company @relation(fields: [companyId], references: [id])

  date   DateTime
  amount Float
  method SaleMethod

  createdAt DateTime @default(now())

  @@unique([companyId, date, method])
}

enum SaleMethod {
  CASH
  CARD
}

model Message {
  id String @id @default(cuid())

  companyId String
  company   Company @relation(fields: [companyId], references: [id])

  employeeId String?
  employee   Employee? @relation(fields: [employeeId], references: [id])

  title   String?
  content String

  isBroadcast Boolean @default(false)
  isRead      Boolean @default(false)

  createdAt DateTime @default(now())

  @@index([companyId])
  @@index([employeeId])
}

model EmployeeMessage {
  id String @id @default(cuid())

  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id])

  companyId String
  company   Company @relation(fields: [companyId], references: [id])

  title   String?
  content String

  isRead Boolean @default(false)

  createdAt DateTime @default(now())

  @@index([companyId])
  @@index([employeeId])
}
